<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Prepare Windows Azure Active Directory • Azure Citadel</title>
    
    <meta name="keywords" content="aad, identity, hybrid">
    
    	<!-- Twitter Cards -->
	<meta name="twitter:title" content="Prepare Windows Azure Active Directory">
	
	<meta name="twitter:site" content="@https://twitter.com/adambohle">
	
	
	<meta name="twitter:card" content="summary">
	<meta name="twitter:image" content="http://localhost:4000/images/MSLogo.jpg">
	
	<!-- Open Graph -->
	<meta property="og:locale" content="en">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Prepare Windows Azure Active Directory">
	
	<meta property="og:url" content="http://localhost:4000/labs/identity/prepare-ad/">
	<meta property="og:site_name" content="Azure Citadel">

    <link rel="canonical" href="http://localhost:4000/labs/identity/prepare-ad/">

    <link href="http://localhost:4000/atom.xml" type="application/atom+xml" rel="alternate" title="Azure Citadel Atom Feed">
    <link href="http://localhost:4000/sitemap.xml" type="application/xml" rel="sitemap" title="Sitemap">

    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="cleartype" content="on">

    <link rel="stylesheet" href="http://localhost:4000/css/main.css">
    <!-- HTML5 Shiv and Media Query Support for IE -->
    <!--[if lt IE 9]>
      <script src="http://localhost:4000/js/vendor/html5shiv.min.js"></script>
      <script src="http://localhost:4000/js/vendor/respond.min.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="/slick/slick-theme.css"/>

  </head>

  <body id="js-body">
    <!--[if lt IE 9]><div class="upgrade notice-warning"><strong>Your browser is quite old!</strong> Why not <a href="http://whatbrowser.org/">upgrade to a newer one</a> to better enjoy this site?</div><![endif]-->

      <header id="masthead">
  <div class="inner-wrap">
    <a href="http://localhost:4000/" class="site-title">Azure Citadel</a>
    <nav role="navigation" class="menu top-menu">
        <ul class="menu-item">
	<li class="home"><a href="/">Azure Citadel</a></li>
	
    
    <li><a href="http://localhost:4000/workshops/" >Workshops</a></li>
  
    
    <li><a href="http://localhost:4000/demos/" >Demos</a></li>
  
    
    <li><a href="http://localhost:4000/labs/" >Labs</a></li>
  
    
    <li><a href="http://localhost:4000/guides/" >Guides</a></li>
  
    
    <li><a href="http://localhost:4000/blog/" >Blog</a></li>
  
</ul>
    </nav>
  </div><!-- /.inner-wrap -->
</header><!-- /.masthead -->
    <nav role="navigation" id="js-menu" class="sliding-menu-content">
  <h5>Azure Citadel <span>Table of Contents</span></h5>
  <ul class="menu-item">
    <li>
      <a href="http://localhost:4000/workshops/">
        
        <div class="title">Workshops</div>
        <p class="excerpt">Interactive Workshops</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/demos/">
        
        <div class="title">Demos</div>
        <p class="excerpt">Guided Demos</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/labs/">
        
        <div class="title">Labs</div>
        <p class="excerpt">Hands On Labs</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/guides/">
        
        <div class="title">Guides</div>
        <p class="excerpt">Tech Guides</p>
      </a>
    </li><li>
      <a href="http://localhost:4000/blog/">
        
        <div class="title">Blog</div>
        <p class="excerpt">Blog Posts</p>
      </a>
    </li>
  </ul>
</nav>
<button type="button" id="js-menu-trigger" class="sliding-menu-button lines-button x2" role="button" aria-label="Toggle Navigation">
  <span class="nav-lines"></span>
</button>

<div id="js-menu-screen" class="menu-screen"></div>


    <div id="page-wrapper">
      <div id="main" role="main">
	<article class="wrap" itemscope itemtype="http://schema.org/Article">
		
		
		<div class="page-title">
			<h1>Prepare Windows Azure Active Directory</h1>
		</div>
		<div class="inner-wrap">
			<div id="content" class="page-content" itemprop="articleBody">
				<p>Extending Identities to the Cloud.</p>

<nav class="toc">
<ul id="markdown-toc">
  <li><a href="#prepare-windows-active-directory" id="markdown-toc-prepare-windows-active-directory">Prepare Windows Active Directory</a></li>
</ul>

</nav>

<h2 id="prepare-windows-active-directory">Prepare Windows Active Directory</h2>
<p>Now we need to configure our on premise domain to match the newly created and verified domain (if you own it) and configure our on premise identities to match. 
I will edit my on premise domain <strong>wildecompany.local</strong> then my users so they no longer log in as <strong>wildecompany.local</strong>, instead now log into <strong>wilde.company</strong>.</p>

<ol>
  <li>Connect to Domain Controller as a domain administrator, from server manager <strong>Tools &gt; Active Directory Domains and Trusts &gt;</strong> right click on <strong>Active Directory Domains and Trusts &gt; Properties</strong></li>
</ol>

<p><img src="../images/ExtendingIdentities_3.1.png" alt="" /></p>

<ol>
  <li>Enter your verified domain name &gt; <strong>Add</strong></li>
</ol>

<p><em>I have added wilde.company</em></p>

<p><img src="../images/ExtendingIdentities_3.2.png" alt="" /></p>

<ol>
  <li>In Active Directory users and computers change the UPN suffix, open user <strong>&gt; Account &gt;</strong> Select newly added UPN suffix <strong>&gt; OK</strong></li>
</ol>

<p><em>Notice the original and new UPN suffix we’ve just created, I have changed my user1 from @wildecomany.local to @wilde.company.</em></p>

<p><img src="../images/ExtendingIdentities_3.3.png" alt="" /></p>

<ol>
  <li>Completing this task manually will work fine but let’s try using a script to save time, run Windows PowerShell ISE as an administrator and paste both of the lines below:</li>
</ol>

<p><code class="highlighter-rouge">$LocalUsers = Get-ADUser -Filter {UserPrincipalName -like "*originaluserprincipalname"} -Properties userPrincipalName -ResultSetSize $null</code></p>

<p><code class="highlighter-rouge">$LocalUsers | foreach {$newUpn = $_.UserPrincipalName.Replace("originaluserprincipalname","newuserprinciplname"); $_ | Set-ADUser -UserPrincipalName $newUpn}</code></p>

<p><em>Replace all of originaluserprincipalname and newuserprincipalname and Run</em></p>

<p><em>Here are my settings:</em></p>
<ul>
  <li><em>originaluserprincipalname = wildecompany.local</em></li>
  <li><em>newuserprincipalname = wilde.company</em></li>
</ul>

<p><code class="highlighter-rouge">$LocalUsers = Get-ADUser -Filter {UserPrincipalName -like "*wildecompany.local"} -Properties userPrincipalName -ResultSetSize $null</code></p>

<p><code class="highlighter-rouge">$LocalUsers | foreach {$newUpn = $_.UserPrincipalName.Replace("wildecompany.local","wilde.company"); $_ | Set-ADUser -UserPrincipalName $newUpn}</code></p>

<p><img src="../images/ExtendingIdentities_3.4.png" alt="" /></p>

<ol>
  <li>Verify in Active Directory Users and Computers the script has worked by opening up another user &gt; <strong>Account</strong></li>
</ol>

<p><em>Notice my user3 logon name is user3@wilde.company</em></p>

<p><img src="../images/ExtendingIdentities_3.5.png" alt="" /></p>

<p>My <strong>@wildecompany.local</strong> users are now <strong>@wilde.company</strong>. Now we have matched our on premise users our public domain they can have a consistent experience regardless of whether they’re logging in to on premise or cloud apps. This is a fundamental step when migrating identities to the cloud.</p>

<p>Move onto the next lab <a href="./identityconfigueADC.md">Configure AD Connect.</a></p>


				<hr />
				<footer class="page-footer">
					
					<div class="inline-btn">
	<a class="btn-social twitter" href="https://twitter.com/intent/tweet?text=Prepare%20Windows%20Azure%20Active%20Directory&amp;url=http://localhost:4000/labs/identity/prepare-ad/&amp;via=https://twitter.com/adambohle" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i> Share on Twitter</a>
	<a class="btn-social facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/labs/identity/prepare-ad/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i> Share on Facebook</a>
	<a class="btn-social linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/labs/identity/prepare-ad/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i>Share on LinkedIn</a>
</div><!-- /.share-this -->

	<!-- <a class="btn-social linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/labs/identity/prepare-ad/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a> -->


					<div class="page-meta">
	<p>Updated <time datetime="2017-09-19T00:00:00Z" itemprop="datePublished">September 19, 2017</time></p>
</div><!-- /.page-meta -->
				</footer><!-- /.footer -->
				<aside>
					<hr />
<div id="disqus_thread"></div>
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname = 'https-ukpducim-github-io';

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

				</aside>
			</div><!-- /.content -->
		</div><!-- /.inner-wrap -->
		
	</article><!-- ./wrap -->
</div><!-- /#main -->

      <footer role="contentinfo" id="site-footer">
	<nav role="navigation" class="menu bottom-menu">
		<ul class="menu-item">
		
      
			<li><a href="https://azurecitadel.github.io" target="_blank">Azure Citadel</a></li>
		
      
			<li><a href="http://localhost:4000/workshops/" >Workshops</a></li>
		
      
			<li><a href="http://localhost:4000/demos/" >Demos</a></li>
		
      
			<li><a href="http://localhost:4000/labs/" >Labs</a></li>
		
      
			<li><a href="http://localhost:4000/guides/" >Guides</a></li>
		
      
			<li><a href="http://localhost:4000/blogs/" >Blog</a></li>
		
		</ul>
	</nav><!-- /.bottom-menu -->
	<p class="copyright">&#169; 2017 <a href="http://localhost:4000">Azure Citadel</a> powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> + <a href="http://mmistakes.github.io/skinny-bones-jekyll/" rel="nofollow">Skinny Bones</a>.</p>
</footer>
    </div>

    <script src="http://localhost:4000/js/vendor/jquery-1.9.1.min.js"></script>
    <script src="http://localhost:4000/js/main.js"></script>
    <!--script type="text/javascript" src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script-->
    <script type="text/javascript" src="/slick/slick.min.js"></script>

    <script>
      $(document).ready(function () {
        $('.carousel').slick({
          autoplay: true,
          arrows: true,
          dots: true
        });
      });
    </script>

  </body>

</html>
